<main data-role="message-page">
    <header >
        <h1>{{ 'MESSAGE_TITLE' | t }}</h1>
    </header>
    <div class="buttons-top">
        <button data-button="inbox" [class.active]=" box == 'inbox' " (click)="onClickBox( 'inbox' )">
            {{ 'INBOX' | t }}
        </button>
        <button data-button="sentbox" [class.active]=" box == 'sent' " (click)="onClickBox( 'sent' )">
            {{ 'SENT' | t }}
        </button>
    </div>

    <div class="message-tab">
        <label for="allMessage">
            <input id="allMessage" type='radio' name='filterMessage' [value]="''" [checked]=" filterMessage == '' " [(ngModel)]=" filterMessage " (ngModelChange)="loadDefault()"> 
            <span>{{ 'ALL_MESSAGE' | t }}</span>
        </label>
        <label for="personalMessage" >
            <input id="personalMessage" type='radio' name='filterMessage'  [value]="'M'" [checked]=" filterMessage =='M' " [(ngModel)]=" filterMessage " (ngModelChange)="loadDefault()"> 
            <span>{{ 'PERSONAL_MESSAGE' | t }}</span>
        </label>
        <label for="auctionMessage" *ngIf=" a.isTeacher && box=='sent' || a.isStudent && box=='inbox'  ">
            <input id="auctionMessage" type='radio' name='filterMessage'[value]="'A'" [checked]=" filterMessage =='A' " [(ngModel)]=" filterMessage " (ngModelChange)="loadDefault()"> 
            <span>{{ 'AUCTION_MESSAGE' | t }}</span>
        </label>
        <div class="read-all-button" *ngIf=" box=='inbox' " (click)="onClickReadAll()">{{ 'READ_ALL_MESSAGE' | t }}</div>
    </div>

    <div class="loader" *ngIf=" loading ">
        <mat-spinner [diameter]="48"></mat-spinner>
        <span>{{ 'IN LOADING' | t}}</span>
    </div>


    <div class="view-message" *ngIf=" data && data.view">
        {{ data.view | json }}
    </div>


    <div class="message-list" *ngIf=" data ">
        <ng-container  *ngFor=" let message of data.messages ">

            <div class="message" (click)="onClickMessage(message)">
                <div class="photo">
                    <img src="{{ message?.sender_photoURL? message.sender_photoURL: a.anonymousPhotoURL}}">
                </div>
                <div class="message-info container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-12 sender"><span>{{'SENDER' | t}}</span>: {{message.sender_name}}</div>
                        <div class="col-lg-6 col-12 title" [class.new]="message.open == 0"><span>{{'SUBJECT' | t}}</span>: {{message.title}}</div>
                        <div class="col-lg-3 col-12 date">{{ message.stamp * 1000 | date:'medium'}}</div>
                    </div>
                </div>
            </div>

            <div class="content" *ngIf="message.view" (click)="onClickMessage(message)">
                {{message.content}}
                <div *ngIf=" message.status != '' && box != 'sent' ">
                    <button class="reply-button" (click)=" messageSend.open( {ID: message.sender, name: message.sender_name} ) ">
                        <span>
                            <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"></path></svg>
                        </span>
                        <span>Reply</span>
                    </button>
                </div>
            </div>
        </ng-container>


        <div class="buttons-bottom">
            <div class="pb-5" *ngIf="message_count < limit">{{ 'NO_MORE_MESSAGES' | t }}</div>
            <button *ngIf="page_no > 1" (click)="onClickPrevious()">{{ 'PREVIOUS' | t }}</button>
            <button *ngIf="message_count == limit" (click)="onClickNext()"> {{ 'NEXT' | t }}</button>
        </div>

    </div>




</main>